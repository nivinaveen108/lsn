<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Lalithasahasranaamam Audio Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --mah-color: #ffcc33; /* default highlight color (gold) */
}

/* Basic page styles (kept from your theme) */
body {
    margin: 0;
    padding: 40px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: linear-gradient(135deg, #0f0f0f, #1b1b1b, #101010);
    background-size: 300% 300%;
    animation: bgshift 20s ease infinite;
    text-align: center;
    color: #fff;
    transition: background 0.5s, color 0.5s;
}
@keyframes bgshift { 0% {background-position:0% 50%} 50% {background-position:100% 50%} 100% {background-position:0% 50%} }

.glass {
    width: 80%;
    margin: auto;
    padding: 30px;
    border-radius: 25px;
    background: rgba(255, 255, 255, 0.12);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    box-shadow: 0 8px 40px rgba(0,0,0,0.4);
    border: 1px solid rgba(255,255,255,0.18);
    transition: background 0.5s, box-shadow 0.5s;
}

.controls {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
}

button, select {
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 14px;
    background: rgba(255,255,255,0.25);
    border: 1px solid rgba(255,255,255,0.25);
    backdrop-filter: blur(15px);
    color: #000;
    cursor: pointer;
    transition: 0.2s;
}
button:hover, select:hover { background: rgba(255,255,255,0.35); }
select option { color: #000; background: #fff; }
input[type=range] { width:200px; }

#sub1,#sub2,#sub3 { font-size:28px; margin-top:25px; white-space:pre-line; transition:color 0.5s,font-size 0.3s; line-height:1.4; }
#sub2,#sub3 { font-size:22px; color:#ddd; }

.checkbox-container, .font-controls, .theme-controls, .seek-container, .highlight-controls {
    margin-top:15px; font-size:16px;
    display:flex; justify-content:center; align-items:center; gap:10px;
}
.top-buttons button {
  position: relative;
  width: 65px;
  height: 65px;
  border-radius: 50%;
  background-color: rgba(255,255,255,0.12);
  color: #fff;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
  flex-direction: column;
}

.top-buttons button:hover {
  background-color: rgba(255,255,255,0.25);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.7);
}

.top-buttons .icon-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.top-buttons i {
  font-size: 1.6rem;
  color: #ffd700; /* golden accent */
  text-shadow: 0 1px 3px rgba(0,0,0,0.4);
}

.top-buttons .icon-text {
  margin-top: 3px;
  font-size: 0.65rem;
  color: #fff;
  letter-spacing: 0.4px;
  opacity: 0.9;
  text-align: center;
}
/* Mahaprana underline style (Option C) */
.mahapraana {
    font-weight: bold;
    color: var(--mah-color);   /* MahƒÅprƒÅ·πáa highlight color */
    display: inline;
    line-height: 1.2;
    padding: 0;
    margin: 0;
}

/* small UI tweaks */
.color-swatch { width:20px; height:20px; border-radius:4px; display:inline-block; border:1px solid rgba(0,0,0,0.2); cursor:pointer; }
.preset-btn { padding:6px 8px; border-radius:6px; cursor:pointer; border:1px solid rgba(255,255,255,0.15); background:rgba(255,255,255,0.06); }

#seekTooltip{
  position: absolute;
  padding: 6px 10px;
  font-size: 14px;
  background: rgba(0,0,0,0.75);
  color: #fff;
  border-radius: 6px;
  pointer-events: none;
  opacity: 0;
  transform: translate(-50%, -120%);
  transition: opacity 0.15s;
  white-space: nowrap;
  z-index: 999;
}


</style>
</head>

<body>

<h1 style="font-weight:600;">Sri Lalithasahasranaamam Player</h1>


<div class="glass">

    <!-- Audio Controls -->
    <div class="controls">
        <button id="playPause">Play</button>
        <button id="muteBtn">Mute</button>

        <div>
            <label>Volume</label><br>
            <input type="range" id="volume" min="0" max="1" step="0.05" value="1">
        </div>

        <div>
            <label>Speed</label><br>
            <input type="range" id="speed" min="0.5" max="2" step="0.1" value="1">
        </div>

<div class="top-buttons" style="display:flex; justify-content:center; gap:20px; margin-bottom:20px;">
  <button id="home-btn" title="Home">
    <div class="icon-wrapper">
      <i class="fa-solid fa-house"></i>
      <span class="icon-text">Home</span>
    </div>
  </button>

  <button id="narayaneeyam-btn" title="NƒÅrƒÅyanƒ´yam">
    <div class="icon-wrapper">
      <i class="fa-solid fa-book"></i>
      <span class="icon-text">NƒÅrƒÅyanƒ´yam</span>
    </div>
  </button>

  <button id="vishnu-btn" title="Vishnu Sahasranamam">
    <div class="icon-wrapper">
      <i class="fa-solid fa-person-praying"></i>
      <span class="icon-text">Vishnu SahasranƒÅmam</span>
    </div>
  </button>
</div>


    </div>

    <!-- Seek Bar -->
    <div class="seek-container">
        <span id="elapsed">0:00</span>
        <input type="range" id="seekBar" min="0" max="100" value="0" style="flex:1;">
        <span id="remaining">0:00</span>
    </div>
    <div id="seekTooltip"></div>
<div class="seek-container" style="margin-top:10px;">
  <label for="jumpSelect">Jump to:</label>
  <select id="jumpSelect">
    <option value="">Select‚Ä¶</option>
  </select>
</div>



    <!-- Language + Font + Highlight controls -->
    <div class="checkbox-container">
        <input type="checkbox" id="showEnglish">
        <label for="showEnglish">English</label>

        <input type="checkbox" id="showOtherLang">
        <label for="showOtherLang">Other Language</label>

        <select id="otherLangSelect">
            <option value="malayalam">Malayalam</option>
            <option value="tamil">Tamil</option>
        </select>

        <select id="fontSelect">
            <option value="'Noto Serif Devanagari', serif">Noto Serif Devanagari</option>
            <option value="'Kokila', serif">Kokila</option>
            <option value="'Samarkan', cursive">Samarkan</option>
            <option value="'Hind Vadodara', serif">Hind Vadodara</option>
            <option value="'Sahadeva', serif">Sahadeva</option>
            <option value="'Lohit Devanagari', serif">Lohit Devanagari</option>
            <option value="'Tangerine', cursive">Tangerine</option>
        </select>
        <button id="fontInc">A+</button>
        <button id="fontDec">A-</button>

        <select id="themeSelect">
            <option value="glass1">Apple Glass</option>
            <option value="sunset">Sunset Gradient</option>
            <option value="ocean">Ocean Blue</option>
            <option value="forest">Forest Green</option>
        </select>
        <button id="darkModeToggle">Dark Mode</button>
    </div>

    <!-- Highlight Controls -->
    <div class="highlight-controls">
        <input type="checkbox" id="mahToggle" >
        <label for="mahToggle">MahƒÅprƒÅ·πáa Highlight</label>

        <label style="margin-left:8px;">Highlight Color</label>
        <input type="color" id="mahColorPicker" value="#ffcc33">

        <!-- quick presets -->
        <div class="preset-btn" data-color="#ffcc33" title="Gold">Gold</div>
        <div class="preset-btn" data-color="#ff6666" title="Red">Red</div>
        <div class="preset-btn" data-color="#66b3ff" title="Blue">Blue</div>
        <div class="preset-btn" data-color="#7CFC00" title="Green">Green</div>
    </div>

    <!-- Subtitles -->
    <div id="sub1" style="font-family:'Noto Serif Devanagari', serif;"></div>
    <div id="sub2" style="font-family:system-ui, sans-serif;"></div>
    <div id="sub3" style="font-family:'Noto Serif Tamil, Noto Serif Malayalam, serif';"></div>

</div>

<div id="ytPlayer" style="display:none;"></div>

<script>
// ------------------------------
// Config / Files
// ------------------------------
const VIDEO_ID = "PGRhM77OSU0";
const DEVANAGARI_VTT = "LSN_Devanagari_output.vtt";
const ENGLISH_VTT = "LSN_English_output.vtt";
const THIRD_LANG_VTT = { tamil: "LSN_Tamil_output.vtt", malayalam: "LSN_Malayalam_output.vtt" };

let cues1 = [], cues2 = [], cues3 = [];
let ytPlayer = null;
let darkMode = false;

// ------------------------------
// Load YouTube API
// ------------------------------
let tag = document.createElement("script");
tag.src = "https://www.youtube.com/iframe_api";
document.head.appendChild(tag);

function onYouTubeIframeAPIReady(){
    ytPlayer = new YT.Player("ytPlayer",{
        height:"0", width:"0", videoId:VIDEO_ID,
        playerVars:{autoplay:0,controls:0,disablekb:1,fs:0,modestbranding:1,rel:0,enablejsapi:1,origin:"https://www.youtube.com"}
    });
}

// ------------------------------
// Utilities: parse VTT + to seconds
// ------------------------------
function toSec(t){ const [h,m,s] = t.split(":"); return (+h*3600) + (+m*60) + parseFloat(s); }

function parseVTT(text, cueList){
    const lines = text.split(/\r?\n/);
    cueList.length = 0;
    let cue = null;
    const timeRe = /(\d{2}:\d{2}:\d{2}\.\d{3}) --> (\d{2}:\d{2}:\d{2}\.\d{3})/;
    for (let l of lines){
        l = l.trim();
        if (timeRe.test(l)){
            const [, start, end] = l.match(timeRe);
            cue = { start: toSec(start), end: toSec(end), text: "" };
        } else if (l === ""){
            if (cue) { cueList.push(cue); cue = null; }
        } else if (cue){
            cue.text += (cue.text ? "\n" : "") + l;
        }
    }
}

// ------------------------------
// Load VTTs
// ------------------------------
fetch(DEVANAGARI_VTT)
  .then(r => r.text())
  .then(txt => {
      parseVTT(txt, cues1);
      buildJumpMenu();   // üîë populate dropdown
  })
  .catch(console.error);

fetch(ENGLISH_VTT).then(r => r.text()).then(txt => parseVTT(txt, cues2)).catch(console.error);

function loadThirdLang(){
    const lang = document.getElementById("otherLangSelect").value;
    fetch(THIRD_LANG_VTT[lang]).then(r => r.text()).then(txt => parseVTT(txt, cues3)).catch(console.error);
}
loadThirdLang();
document.getElementById("otherLangSelect").onchange = loadThirdLang;

document.getElementById("home-btn").onclick = () => {
    window.location.href = "https://www.nivi108.com";
};

document.getElementById("narayaneeyam-btn").onclick = () => {
    window.location.href = "https://nivinaveen108.github.io/narayaneeyam/";
};

document.getElementById("vishnu-btn").onclick = () => {
    window.location.href = "https://nivinaveen108.github.io/vishnusahasranaamam/";
};

// Top buttons click handlers
const homeBtn = document.getElementById("home-btn");
if(homeBtn) homeBtn.onclick = () => window.location.href = "https://www.nivi108.com";

const narayaneeyamBtn = document.getElementById("narayaneeyam-btn");
if(narayaneeyamBtn) narayaneeyamBtn.onclick = () => window.location.href = "https://nivinaveen108.github.io/narayaneeyam/";

const vishnuBtn = document.getElementById("vishnu-btn");
if(vishnuBtn) vishnuBtn.onclick = () => window.location.href = "https://nivinaveen108.github.io/vsn/";

// ------------------------------
// DOM refs
// ------------------------------
const sub1 = document.getElementById("sub1"),
      sub2 = document.getElementById("sub2"),
      sub3 = document.getElementById("sub3"),
      seekBar = document.getElementById("seekBar"),
      elapsed = document.getElementById("elapsed"),
      remaining = document.getElementById("remaining");

const playPause = document.getElementById("playPause");
const muteBtn = document.getElementById("muteBtn");
const volumeSlider = document.getElementById("volume");
const speedSlider = document.getElementById("speed");

const mahToggle = document.getElementById("mahToggle");
const mahColorPicker = document.getElementById("mahColorPicker");

// apply color variable initially
document.documentElement.style.setProperty('--mah-color', mahColorPicker.value);

// preset buttons
document.querySelectorAll('.preset-btn').forEach(b=>{
    b.style.background = b.getAttribute('data-color');
    b.onclick = () => { mahColorPicker.value = b.getAttribute('data-color'); mahColorPicker.dispatchEvent(new Event('input')); };
});

// color picker event
mahColorPicker.addEventListener('input', (e)=>{
    document.documentElement.style.setProperty('--mah-color', e.target.value);
});

// ------------------------------
// Robust MahƒÅprƒÅ·πáa highlighting
// ------------------------------
const sortByLengthDesc = arr => arr.sort((a,b)=>b.length - a.length);

function highlightMahapraana(text, script='devanagari'){
    if(!text) return '';
    text = String(text).normalize('NFC');

    if(!mahToggle.checked) return text;

    const sortByLengthDesc = arr => arr.sort((a,b) => b.length - a.length);

    let patterns = [];
    switch(script){
        case 'devanagari':
            patterns = sortByLengthDesc([
                  // basic aspirates
                  '‡§ñ','‡§ò','‡§õ','‡§ù','‡§†','‡§¢','‡§•','‡§ß','‡§´','‡§≠',
                  // frequent aspirated clusters / conjuncts
                  '‡§∏‡•ç‡§•','‡§∏‡•ç‡§•‡§ø','‡§∏‡•ç‡§´','‡§∏‡•ç‡§´‡•Å','‡§¶‡•ç‡§≠','‡§¶‡•ç‡§ò','‡§¶‡•ç‡§ß','‡§£‡•ç‡§†','‡§ö‡•ç‡§õ','‡§ö‡•ç‡§õ‡§æ',
                  '‡§∞‡•ç‡§≠','‡§¨‡•ç‡§ß','‡§¨‡•ç‡§ß‡•á','‡§∞‡•ç‡§•','‡§ó‡•ç‡§ß','‡§®‡•ç‡§ß','‡§∞‡•ç‡§•‡•ç‡§Ø','‡§∞‡•ç‡§•‡§æ'
            ]);
            break;
        case 'malayalam':
            patterns = sortByLengthDesc([
                                 // basic aspirates
                  '‡¥ñ','‡¥ò','‡¥õ','‡¥ù','‡¥†','‡¥¢','‡¥•','‡¥ß','‡¥´','‡¥≠',
                  // variants / clusters
                  '‡¥∏‡µç‡¥•','‡¥∏‡µç‡¥•‡¥ø','‡¥∏‡µç‡¥´','‡¥∏‡µç‡¥´‡µÅ','‡¥¶‡µç‡¥≠','‡¥¶‡µç‡¥ò','‡¥¶‡µç‡¥ß','‡¥£‡µç‡¥†',
                  // aspirated CH forms
                  '‡¥õ‡¥æ','‡¥õ‡µç','‡¥∏‡µç‡¥µ‡¥õ','‡¥õ‡µç‡¥ö','‡¥õ‡µç‡¥§',
                  '‡µº‡¥≠','‡¥¨‡µç‡¥ß','‡¥¨‡µç‡¥ß‡µÜ','‡µº‡¥•','‡¥ó‡µç‡¥ß','‡¥®‡µç‡¥ß','‡¥∞‡µç‚Äç‡¥§‡µç‡¥•‡µç‡¥Ø','‡¥∞‡µç‚Äç‡¥§‡µç‡¥•‡¥æ'
            ]);
            break;
        case 'english':
            patterns = sortByLengthDesc([
                  'kh','gh','chh','jh','·π≠h','·∏çh','th','dh','ph','bh',
                  'stha','sthi','sph','sphu','dbh','ddh','·πá·π≠h',
                  'cch','cchƒÅ','svacch','rbh','bdh','bdhe','rth','gdh','ndh','rthya','rthƒÅ'
            ]);
            break;
     case 'tam': // Tamil MahƒÅprƒÅ·πáa-like sequences
    patterns = sortByLengthDesc([

 '‡Æï¬≤','‡Æï‡Ææ¬≤','‡Æï‡Æø¬≤','‡Æï‡ØÄ¬≤','‡Æï‡ØÅ¬≤','‡Æï‡ØÇ¬≤','‡Æï‡ØÜ¬≤','‡Æï‡Øá¬≤','‡Æï‡Øà¬≤','‡Æï‡Øä¬≤','‡Æï‡Øã¬≤','‡Æï‡Øå¬≤',
  '‡Æï‚Å¥','‡Æï‡Ææ‚Å¥','‡Æï‡Æø‚Å¥','‡Æï‡ØÄ‚Å¥','‡Æï‡ØÅ‚Å¥','‡Æï‡ØÇ‚Å¥','‡Æï‡ØÜ‚Å¥','‡Æï‡Øá‚Å¥','‡Æï‡Øà‚Å¥','‡Æï‡Øä‚Å¥','‡Æï‡Øã‚Å¥','‡Æï‡Øå‚Å¥',
  '‡Æö¬≤','‡Æö‡Ææ¬≤','‡Æö‡Æø¬≤','‡Æö‡ØÄ¬≤','‡Æö‡ØÅ¬≤','‡Æö‡ØÇ¬≤','‡Æö‡ØÜ¬≤','‡Æö‡Øá¬≤','‡Æö‡Øà¬≤','‡Æö‡Øä¬≤','‡Æö‡Øã¬≤','‡Æö‡Øå¬≤',
  '‡Æú‚Å¥','‡Æú‡Ææ‚Å¥','‡Æú‡Æø‚Å¥','‡Æú‡ØÄ‚Å¥','‡Æú‡ØÅ‚Å¥','‡Æú‡ØÇ‚Å¥','‡Æú‡ØÜ‚Å¥','‡Æú‡Øá‚Å¥','‡Æú‡Øà‚Å¥','‡Æú‡Øä‚Å¥','‡Æú‡Øã‚Å¥','‡Æú‡Øå‚Å¥',
  '‡Æü¬≤','‡Æü‡Ææ¬≤','‡Æü‡Æø¬≤','‡Æü‡ØÄ¬≤','‡Æü‡ØÅ¬≤','‡Æü‡ØÇ¬≤','‡Æü‡ØÜ¬≤','‡Æü‡Øá¬≤','‡Æü‡Øà¬≤','‡Æü‡Øä¬≤','‡Æü‡Øã¬≤','‡Æü‡Øå¬≤',
  '‡Æü‚Å¥','‡Æü‡Ææ‚Å¥','‡Æü‡Æø‚Å¥','‡Æü‡ØÄ‚Å¥','‡Æü‡ØÅ‚Å¥','‡Æü‡ØÇ‚Å¥','‡Æü‡ØÜ‚Å¥','‡Æü‡Øá‚Å¥','‡Æü‡Øà‚Å¥','‡Æü‡Øä‚Å¥','‡Æü‡Øã‚Å¥','‡Æü‡Øå‚Å¥',
  '‡Æ§¬≤','‡Æ§‡Ææ¬≤','‡Æ§‡Æø¬≤','‡Æ§‡ØÄ¬≤','‡Æ§‡ØÅ¬≤','‡Æ§‡ØÇ¬≤','‡Æ§‡ØÜ¬≤','‡Æ§‡Øá¬≤','‡Æ§‡Øà¬≤','‡Æ§‡Øä¬≤','‡Æ§‡Øã¬≤','‡Æ§‡Øå¬≤',
  '‡Æ§‚Å¥','‡Æ§‡Ææ‚Å¥','‡Æ§‡Æø‚Å¥','‡Æ§‡ØÄ‚Å¥','‡Æ§‡ØÅ‚Å¥','‡Æ§‡ØÇ‚Å¥','‡Æ§‡ØÜ‚Å¥','‡Æ§‡Øá‚Å¥','‡Æ§‡Øà‚Å¥','‡Æ§‡Øä‚Å¥','‡Æ§‡Øã‚Å¥','‡Æ§‡Øå‚Å¥',
  '‡Æ™¬≤','‡Æ™‡Ææ¬≤','‡Æ™‡Æø¬≤','‡Æ™‡ØÄ¬≤','‡Æ™‡ØÅ¬≤','‡Æ™‡ØÇ¬≤','‡Æ™‡ØÜ¬≤','‡Æ™‡Øá¬≤','‡Æ™‡Øà¬≤','‡Æ™‡Øä¬≤','‡Æ™‡Øã¬≤','‡Æ™‡Øå¬≤',
  '‡Æ™‚Å¥','‡Æ™‡Ææ‚Å¥','‡Æ™‡Æø‚Å¥','‡Æ™‡ØÄ‚Å¥','‡Æ™‡ØÅ‚Å¥','‡Æ™‡ØÇ‚Å¥','‡Æ™‡ØÜ‚Å¥','‡Æ™‡Øá‚Å¥','‡Æ™‡Øà‚Å¥','‡Æ™‡Øä‚Å¥','‡Æ™‡Øã‚Å¥','‡Æ™‡Øå‚Å¥',
  '‡Æ∏‡Øç‡Æ§¬≤','‡Æ∏‡Øç‡Æ§‡Ææ¬≤','‡Æ∏‡Øç‡Æ§‡Æø¬≤','‡Æ∏‡Øç‡Æ§‡ØÄ¬≤','‡Æ∏‡Øç‡Æ§‡ØÅ¬≤','‡Æ∏‡Øç‡Æ§‡ØÇ¬≤','‡Æ∏‡Øç‡Æ§‡ØÜ¬≤','‡Æ∏‡Øç‡Æ§‡Øá¬≤','‡Æ∏‡Øç‡Æ§‡Øà¬≤','‡Æ∏‡Øç‡Æ§‡Øä¬≤','‡Æ∏‡Øç‡Æ§‡Øã¬≤','‡Æ∏‡Øç‡Æ§‡Øå¬≤',
  '‡Æ∏‡Øç‡Æ§‡Æø¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡Ææ¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡Æø¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡ØÄ¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡ØÅ¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡ØÇ¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡ØÜ¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡Øá¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡Øà¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡Øä¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡Øã¬≤','‡Æ∏‡Øç‡Æ§‡Æø‡Øå¬≤',
  '‡Æ∏‡Øç‡Æ™¬≤','‡Æ∏‡Øç‡Æ™‡Ææ¬≤','‡Æ∏‡Øç‡Æ™‡Æø¬≤','‡Æ∏‡Øç‡Æ™‡ØÄ¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ¬≤','‡Æ∏‡Øç‡Æ™‡ØÇ¬≤','‡Æ∏‡Øç‡Æ™‡ØÜ¬≤','‡Æ∏‡Øç‡Æ™‡Øá¬≤','‡Æ∏‡Øç‡Æ™‡Øà¬≤','‡Æ∏‡Øç‡Æ™‡Øä¬≤','‡Æ∏‡Øç‡Æ™‡Øã¬≤','‡Æ∏‡Øç‡Æ™‡Øå¬≤',
  '‡Æ∏‡Øç‡Æ™‡ØÅ¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡Ææ¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡Æø¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡ØÄ¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡ØÅ¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡ØÇ¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡ØÜ¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡Øá¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡Øà¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡Øä¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡Øã¬≤','‡Æ∏‡Øç‡Æ™‡ØÅ‡Øå¬≤',
  '‡Æ§‡Øç‡Æ™¬≤','‡Æ§‡Øç‡Æ™‡Ææ¬≤','‡Æ§‡Øç‡Æ™‡Æø¬≤','‡Æ§‡Øç‡Æ™‡ØÄ¬≤','‡Æ§‡Øç‡Æ™‡ØÅ¬≤','‡Æ§‡Øç‡Æ™‡ØÇ¬≤','‡Æ§‡Øç‡Æ™‡ØÜ¬≤','‡Æ§‡Øç‡Æ™‡Øá¬≤','‡Æ§‡Øç‡Æ™‡Øà¬≤','‡Æ§‡Øç‡Æ™‡Øä¬≤','‡Æ§‡Øç‡Æ™‡Øã¬≤','‡Æ§‡Øç‡Æ™‡Øå¬≤',
  '‡Æ§‡Øç‡Æï¬≤','‡Æ§‡Øç‡Æï‡Ææ¬≤','‡Æ§‡Øç‡Æï‡Æø¬≤','‡Æ§‡Øç‡Æï‡ØÄ¬≤','‡Æ§‡Øç‡Æï‡ØÅ¬≤','‡Æ§‡Øç‡Æï‡ØÇ¬≤','‡Æ§‡Øç‡Æï‡ØÜ¬≤','‡Æ§‡Øç‡Æï‡Øá¬≤','‡Æ§‡Øç‡Æï‡Øà¬≤','‡Æ§‡Øç‡Æï‡Øä¬≤','‡Æ§‡Øç‡Æï‡Øã¬≤','‡Æ§‡Øç‡Æï‡Øå¬≤',
  '‡Æ§‡Øç‡Æ§¬≤','‡Æ§‡Øç‡Æ§‡Ææ¬≤','‡Æ§‡Øç‡Æ§‡Æø¬≤','‡Æ§‡Øç‡Æ§‡ØÄ¬≤','‡Æ§‡Øç‡Æ§‡ØÅ¬≤','‡Æ§‡Øç‡Æ§‡ØÇ¬≤','‡Æ§‡Øç‡Æ§‡ØÜ¬≤','‡Æ§‡Øç‡Æ§‡Øá¬≤','‡Æ§‡Øç‡Æ§‡Øà¬≤','‡Æ§‡Øç‡Æ§‡Øä¬≤','‡Æ§‡Øç‡Æ§‡Øã¬≤','‡Æ§‡Øç‡Æ§‡Øå¬≤',
  '‡Æ£‡Øç‡Æü¬≤','‡Æ£‡Øç‡Æü‡Ææ¬≤','‡Æ£‡Øç‡Æü‡Æø¬≤','‡Æ£‡Øç‡Æü‡ØÄ¬≤','‡Æ£‡Øç‡Æü‡ØÅ¬≤','‡Æ£‡Øç‡Æü‡ØÇ¬≤','‡Æ£‡Øç‡Æü‡ØÜ¬≤','‡Æ£‡Øç‡Æü‡Øá¬≤','‡Æ£‡Øç‡Æü‡Øà¬≤','‡Æ£‡Øç‡Æü‡Øä¬≤','‡Æ£‡Øç‡Æü‡Øã¬≤','‡Æ£‡Øç‡Æü‡Øå¬≤',
  '‡Æö‡Ææ¬≤','‡Æö‡Ææ‡Ææ¬≤','‡Æö‡Ææ‡Æø¬≤','‡Æö‡Ææ‡ØÄ¬≤','‡Æö‡Ææ‡ØÅ¬≤','‡Æö‡Ææ‡ØÇ¬≤','‡Æö‡Ææ‡ØÜ¬≤','‡Æö‡Ææ‡Øá¬≤','‡Æö‡Ææ‡Øà¬≤','‡Æö‡Ææ‡Øä¬≤','‡Æö‡Ææ‡Øã¬≤','‡Æö‡Ææ‡Øå¬≤',
  '‡Æö‡Øç¬≤','‡Æö‡Øç‡Ææ¬≤','‡Æö‡Øç‡Æø¬≤','‡Æö‡Øç‡ØÄ¬≤','‡Æö‡Øç‡ØÅ¬≤','‡Æö‡Øç‡ØÇ¬≤','‡Æö‡Øç‡ØÜ¬≤','‡Æö‡Øç‡Øá¬≤','‡Æö‡Øç‡Øà¬≤','‡Æö‡Øç‡Øä¬≤','‡Æö‡Øç‡Øã¬≤','‡Æö‡Øç‡Øå¬≤',
  '‡Æ∏‡Øç‡Æµ‡Æö¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡Ææ¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡Æø¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡ØÄ¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡ØÅ¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡ØÇ¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡ØÜ¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡Øá¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡Øà¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡Øä¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡Øã¬≤','‡Æ∏‡Øç‡Æµ‡Æö‡Øå¬≤',
  '‡Æö‡Øç‡Æö¬≤','‡Æö‡Øç‡Æö‡Ææ¬≤','‡Æö‡Øç‡Æö‡Æø¬≤','‡Æö‡Øç‡Æö‡ØÄ¬≤','‡Æö‡Øç‡Æö‡ØÅ¬≤','‡Æö‡Øç‡Æö‡ØÇ¬≤','‡Æö‡Øç‡Æö‡ØÜ¬≤','‡Æö‡Øç‡Æö‡Øá¬≤','‡Æö‡Øç‡Æö‡Øà¬≤','‡Æö‡Øç‡Æö‡Øä¬≤','‡Æö‡Øç‡Æö‡Øã¬≤','‡Æö‡Øç‡Æö‡Øå¬≤',
  '‡Æö‡Øç‡Æ§¬≤','‡Æö‡Øç‡Æ§‡Ææ¬≤','‡Æö‡Øç‡Æ§‡Æø¬≤','‡Æö‡Øç‡Æ§‡ØÄ¬≤','‡Æö‡Øç‡Æ§‡ØÅ¬≤','‡Æö‡Øç‡Æ§‡ØÇ¬≤','‡Æö‡Øç‡Æ§‡ØÜ¬≤','‡Æö‡Øç‡Æ§‡Øá¬≤','‡Æö‡Øç‡Æ§‡Øà¬≤','‡Æö‡Øç‡Æ§‡Øä¬≤','‡Æö‡Øç‡Æ§‡Øã¬≤','‡Æö‡Øç‡Æ§‡Øå¬≤',
  '‡Æ∞‡Øç‡Æ™¬≤','‡Æ∞‡Øç‡Æ™‡Ææ¬≤','‡Æ∞‡Øç‡Æ™‡Æø¬≤','‡Æ∞‡Øç‡Æ™‡ØÄ¬≤','‡Æ∞‡Øç‡Æ™‡ØÅ¬≤','‡Æ∞‡Øç‡Æ™‡ØÇ¬≤','‡Æ∞‡Øç‡Æ™‡ØÜ¬≤','‡Æ∞‡Øç‡Æ™‡Øá¬≤','‡Æ∞‡Øç‡Æ™‡Øà¬≤','‡Æ∞‡Øç‡Æ™‡Øä¬≤','‡Æ∞‡Øç‡Æ™‡Øã¬≤','‡Æ∞‡Øç‡Æ™‡Øå¬≤',
  '‡Æ™‡Øç‡Æ§¬≤','‡Æ™‡Øç‡Æ§‡Ææ¬≤','‡Æ™‡Øç‡Æ§‡Æø¬≤','‡Æ™‡Øç‡Æ§‡ØÄ¬≤','‡Æ™‡Øç‡Æ§‡ØÅ¬≤','‡Æ™‡Øç‡Æ§‡ØÇ¬≤','‡Æ™‡Øç‡Æ§‡ØÜ¬≤','‡Æ™‡Øç‡Æ§‡Øá¬≤','‡Æ™‡Øç‡Æ§‡Øà¬≤','‡Æ™‡Øç‡Æ§‡Øä¬≤','‡Æ™‡Øç‡Æ§‡Øã¬≤','‡Æ™‡Øç‡Æ§‡Øå¬≤',
  '‡Æ™‡Øç‡Æ§‡ØÜ¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡Ææ¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡Æø¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡ØÄ¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡ØÅ¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡ØÇ¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡ØÜ¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡Øá¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡Øà¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡Øä¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡Øã¬≤','‡Æ™‡Øç‡Æ§‡ØÜ‡Øå¬≤',
  '‡Æ∞‡Øç‡Æ§¬≤','‡Æ∞‡Øç‡Æ§‡Ææ¬≤','‡Æ∞‡Øç‡Æ§‡Æø¬≤','‡Æ∞‡Øç‡Æ§‡ØÄ¬≤','‡Æ∞‡Øç‡Æ§‡ØÅ¬≤','‡Æ∞‡Øç‡Æ§‡ØÇ¬≤','‡Æ∞‡Øç‡Æ§‡ØÜ¬≤','‡Æ∞‡Øç‡Æ§‡Øá¬≤','‡Æ∞‡Øç‡Æ§‡Øà¬≤','‡Æ∞‡Øç‡Æ§‡Øä¬≤','‡Æ∞‡Øç‡Æ§‡Øã¬≤','‡Æ∞‡Øç‡Æ§‡Øå¬≤',
  '‡Æï‡Øç‡Æ§¬≤','‡Æï‡Øç‡Æ§‡Ææ¬≤','‡Æï‡Øç‡Æ§‡Æø¬≤','‡Æï‡Øç‡Æ§‡ØÄ¬≤','‡Æï‡Øç‡Æ§‡ØÅ¬≤','‡Æï‡Øç‡Æ§‡ØÇ¬≤','‡Æï‡Øç‡Æ§‡ØÜ¬≤','‡Æï‡Øç‡Æ§‡Øá¬≤','‡Æï‡Øç‡Æ§‡Øà¬≤','‡Æï‡Øç‡Æ§‡Øä¬≤','‡Æï‡Øç‡Æ§‡Øã¬≤','‡Æï‡Øç‡Æ§‡Øå¬≤',
  '‡Æ®‡Øç‡Æ§¬≤','‡Æ®‡Øç‡Æ§‡Ææ¬≤','‡Æ®‡Øç‡Æ§‡Æø¬≤','‡Æ®‡Øç‡Æ§‡ØÄ¬≤','‡Æ®‡Øç‡Æ§‡ØÅ¬≤','‡Æ®‡Øç‡Æ§‡ØÇ¬≤','‡Æ®‡Øç‡Æ§‡ØÜ¬≤','‡Æ®‡Øç‡Æ§‡Øá¬≤','‡Æ®‡Øç‡Æ§‡Øà¬≤','‡Æ®‡Øç‡Æ§‡Øä¬≤','‡Æ®‡Øç‡Æ§‡Øã¬≤','‡Æ®‡Øç‡Æ§‡Øå¬≤',
  '‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡Ææ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡Æø¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡ØÄ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡ØÅ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡ØÇ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡Øá¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡Øá¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡Øà¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡Øä¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡Øã¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡Øå¬≤',
  '‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡Ææ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡Æø¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡ØÄ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡ØÅ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡ØÇ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡ØÜ¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡Øá¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡Øà¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡Øä¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡Øã¬≤','‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Ææ‡Øå¬≤',      
  // basic aspirates
  '‡Æï‡Øç‚Å¥','‡Æô‡Øç‚Å¥','‡Æö‡Øç‚Å¥','‡Æû‡Øç‚Å¥','‡Æü‡Øç‚Å¥','‡Æ£‡Øç‚Å¥','‡Æ§‡Øç‚Å¥','‡Æ®‡Øç‚Å¥','‡Æ™‡Øç‚Å¥','‡ÆÆ‡Øç‚Å¥', '‡Æï‡Øç¬≤' 

  // frequent aspirated clusters / conjuncts
 // '‡Æ∏‡Øç‡Æ§‡Øç‚Å¥','‡Æ∏‡Øç‡Æ§‡Æø‚Å¥','‡Æ∏‡Øç‡Æ™‡Øç‚Å¥','‡Æ∏‡Øç‡Æ™‡ØÅ‚Å¥','‡Æ§‡Øç‡Æ™‡Øç‚Å¥','‡Æ§‡Øç‡Æï‡Øç‚Å¥','‡Æ§‡Øç‡Æ§‡Øç‚Å¥','‡Æ£‡Øç‡Øç‡Æ§‡Øç‚Å¥',
 // '‡Æö‡Øç‚Å¥‡Æö‡Øç‚Å¥','‡Æö‡Øç‚Å¥‡Æö‡Øç‚Å¥‡Ææ',
 // '‡Æ∞‡Øç‡Æ™‡Øç‚Å¥','‡Æ™‡Øç‡Æ§‡Øç‚Å¥','‡Æ™‡Øç‡Æ§‡Øá‚Å¥','‡Æ∞‡Øç‡Æ§‡Øç‚Å¥','‡Æï‡Øç‡Æ§‡Øç‚Å¥','‡Æ®‡Øç‡Æ§‡Øç‚Å¥','‡Æ∞‡Øç‡Æ§‡Øç‡ÆØ‡Øç‚Å¥','‡Æ∞‡Øç‡Æ§‡Ææ‚Å¥'

    ]);
    break;

        default:
            return text;
    }

    const re = new RegExp(patterns.join('|'), script==='english'?'gi':'g');
    return text.replace(re, m => `<span class="mahapraana">${m}</span>`);
}

// ------------------------------
// Subtitle loop
// ------------------------------
setInterval(()=>{
    if(!ytPlayer?.getCurrentTime) return;
    const t = ytPlayer.getCurrentTime();
    const index = cues1.findIndex(c => t>=c.start && t<=c.end);

    const cue1 = index!==-1 ? cues1[index] : null;
    const cue2 = index!==-1 ? cues2[index] : null;
    const cue3 = index!==-1 ? cues3[index] : null;

    // Devanagari
    sub1.innerHTML = cue1 ? highlightMahapraana(cue1.text.trim(),'devanagari') : "";

// English
if(document.getElementById("showEnglish").checked && cue2){
    sub2.innerHTML = highlightMahapraana(cue2.text.trim(), 'english');
} else {
    sub2.innerText = "";
}

    // Third language
    const otherOn = document.getElementById("showOtherLang").checked;
    const lang = document.getElementById("otherLangSelect").value;
    if(otherOn && cue3){
        sub3.innerHTML = highlightMahapraana(cue3.text.trim(), lang==='malayalam'?'malayalam':'tam');
    } else sub3.innerText = "";

    // seek/time
    if(!ytPlayer?.getDuration) return;
    const duration = ytPlayer.getDuration();
    elapsed.innerText = formatTime(t);
    remaining.innerText = formatTime(duration-t);
    seekBar.value = duration ? (t/duration)*100 : 0;
}, 120);

// ------------------------------
// Controls: play/pause, mute, volume, speed
// ------------------------------
playPause.onclick = () => {
    if(!ytPlayer) return;
    const st = ytPlayer.getPlayerState();
    if(st === YT.PlayerState.PLAYING){ ytPlayer.pauseVideo(); playPause.innerText="Play"; }
    else { ytPlayer.playVideo(); playPause.innerText="Pause"; }
};

muteBtn.onclick = () => {
    if(!ytPlayer) return;
    if(ytPlayer.isMuted()){ ytPlayer.unMute(); muteBtn.innerText="Mute"; }
    else { ytPlayer.mute(); muteBtn.innerText="Unmute"; }
};

volumeSlider.oninput = e => { if(ytPlayer) ytPlayer.setVolume(e.target.value*100); };
speedSlider.oninput = e => { if(ytPlayer) ytPlayer.setPlaybackRate(parseFloat(e.target.value)); };

// ------------------------------
// Font controls
// ------------------------------
const fontSelect=document.getElementById("fontSelect"),
      fontInc=document.getElementById("fontInc"),
      fontDec=document.getElementById("fontDec");
let fontSize = 28;
fontSelect.onchange = ()=>{ sub1.style.fontFamily = sub2.style.fontFamily = sub3.style.fontFamily = fontSelect.value; };
fontInc.onclick = ()=>{ fontSize+=2; sub1.style.fontSize=sub2.style.fontSize=sub3.style.fontSize=fontSize+"px"; };
fontDec.onclick = ()=>{ fontSize-=2; if(fontSize<12) fontSize=12; sub1.style.fontSize=sub2.style.fontSize=sub3.style.fontSize=fontSize+"px"; };

// ------------------------------
// Themes/dark mode
// ------------------------------
const themeSelect = document.getElementById("themeSelect"),
      darkToggle = document.getElementById("darkModeToggle");

const themes = {
    glass1:{bg:"linear-gradient(135deg,#0f0f0f,#1b1b1b,#101010)",glass:"rgba(255,255,255,0.12)",text:"#fff",sub:"#fff"},
    sunset:{bg:"linear-gradient(135deg,#ff7e5f,#feb47b)",glass:"rgba(255,255,255,0.18)",text:"#000",sub:"#000"},
    ocean:{bg:"linear-gradient(135deg,#2193b0,#6dd5ed)",glass:"rgba(255,255,255,0.18)",text:"#fff",sub:"#fff"},
    forest:{bg:"linear-gradient(135deg,#56ab2f,#a8e063)",glass:"rgba(255,255,255,0.18)",text:"#000",sub:"#000"}
};

function applyTheme(theme){
    document.body.style.background = theme.bg;
    document.body.style.color = theme.text;
    const g = document.querySelector(".glass");
    g.style.background = theme.glass;
    g.style.boxShadow = darkMode?"0 8px 40px rgba(0,0,0,0.7)":"0 8px 40px rgba(0,0,0,0.4)";
    sub1.style.color = sub2.style.color = sub3.style.color = theme.sub;
    document.querySelectorAll("button, label").forEach(b => b.style.color = theme.text);
    document.querySelectorAll("select").forEach(s => {
        s.style.background = "rgba(255,255,255,0.25)";
        s.style.color = theme.text === "#fff"?"#fff":"#000";
    });
    document.querySelectorAll("select option").forEach(o => {
        o.style.background = theme.text === "#fff"?"#222":"#fff";
        o.style.color = theme.text === "#fff"?"#fff":"#000";
    });
}
themeSelect.onchange = ()=>{ darkMode=false; applyTheme(themes[themeSelect.value]); };
darkToggle.onclick = ()=>{ darkMode=!darkMode; if(darkMode) applyTheme({bg:"#0f0f0f",glass:"rgba(0,0,0,0.5)",text:"#fff",sub:"#fff"}); else applyTheme(themes[themeSelect.value]); };

// ------------------------------
// Seek helper + formatTime
// ------------------------------
function formatTime(seconds){
    const m = Math.floor(seconds/60);
    const s = Math.floor(seconds % 60);
    return `${m}:${s.toString().padStart(2,"0")}`;
}
seekBar.oninput = ()=>{ if(!ytPlayer?.getDuration) return; const duration = ytPlayer.getDuration(); ytPlayer.seekTo((seekBar.value/100)*duration,true); }

// ------------------------------
// Verse structure configuration
// ------------------------------
const NYASA_INDEX = 0;
const DHYANA_START = 1;
const DHYANA_END = 7;
const SAHASRA_START = 8;

const jumpSelect = document.getElementById("jumpSelect");

/* Build dropdown once VTT is loaded */
function buildJumpMenu() {
    jumpSelect.innerHTML = `<option value="">Select‚Ä¶</option>`;

    cues1.forEach((cue, i) => {
        let label;

        if (i === NYASA_INDEX) {
            label = "NyƒÅsah";
        } 
        else if (i >= DHYANA_START && i <= DHYANA_END) {
            label = `DhyƒÅnam ${i - DHYANA_START + 1}`;
        } 
        else if (i >= SAHASRA_START) {
            const verseNum = i - SAHASRA_START + 1;

            if (verseNum > 183) return;   // ‚õî stop at 183

            label = `Verse ${verseNum}`;
        } 
        else return;

        const opt = document.createElement("option");
        opt.value = cue.start;
        opt.textContent = label;
        jumpSelect.appendChild(opt);
    });
}

/* Jump on selection */
jumpSelect.addEventListener("change", () => {
    if (!jumpSelect.value || !ytPlayer) return;
    ytPlayer.seekTo(parseFloat(jumpSelect.value) + 0.01, true);
});


const seekTooltip = document.getElementById("seekTooltip");

seekBar.addEventListener("mousemove", e => {
    if (!ytPlayer?.getDuration() || cues1.length === 0) return;

    const rect = seekBar.getBoundingClientRect();
    const percent = (e.clientX - rect.left) / rect.width;
    if (percent < 0 || percent > 1) return;

    const time = percent * ytPlayer.getDuration();

    const verseIndex = cues1.findIndex(c => time >= c.start && time <= c.end);
    if (verseIndex === -1) return;

    let label;

    if (verseIndex === NYASA_INDEX) {
        label = "NyƒÅsah";
    }
    else if (verseIndex >= DHYANA_START && verseIndex <= DHYANA_END) {
        label = `DhyƒÅnam ${verseIndex - DHYANA_START + 1}`;
    }
    else if (verseIndex >= SAHASRA_START) {
        label = `Verse ${verseIndex - SAHASRA_START + 1}`;
    }

    seekTooltip.innerText = `${label} ‚Äî click to jump`;
    seekTooltip.style.left = `${e.clientX}px`;
    seekTooltip.style.top = `${rect.top}px`;
    seekTooltip.style.opacity = 1;
});

seekBar.addEventListener("mouseleave", () => {
    seekTooltip.style.opacity = 0;
});

seekBar.addEventListener("click", e => {
    if (!ytPlayer?.getDuration() || cues1.length === 0) return;

    const rect = seekBar.getBoundingClientRect();
    const percent = (e.clientX - rect.left) / rect.width;
    const time = percent * ytPlayer.getDuration();

    const cue = cues1.find(c => time >= c.start && time <= c.end);
    if (cue) {
        ytPlayer.seekTo(cue.start + 0.01, true);
    }
});


// Initial theme
applyTheme(themes[themeSelect.value]);

</script>

</body>
</html>



